{"version":3,"sources":["src\\sagas\\auth.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;;AAGA;;AAGA;;;;eAQU,Y,EA6BA,U,EAIA,W,EAQA,qB,EAmBA,mB;;AA5DV,SAAU,YAAV,CAAuB,MAAvB;AAAA,yBAGY,OAHZ,EAIY,GAJZ,EAMc,GANd,EAQY,GARZ,EAQgB,KARhB,EAUc,aAVd;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sCAKY,OAAO,OALnB;AAGY,2BAHZ,mBAGY,OAHZ;AAIY,uBAJZ,mBAIY,GAJZ;AAAA;AAAA,2BAM0B,gCAAW,OAAX,EAAmB,GAAnB,CAN1B;;AAAA;AAMc,uBANd;AAQY,uBARZ,GASY,GATZ,CAQY,GARZ;AAQgB,yBARhB,GASY,GATZ,CAQgB,KARhB;AAUc,iCAVd,GAU8B,KAAK,GAAL,EAV9B;AAAA;AAAA,2BAWc,kBAAI;AACN,8BAAK,eADC;AAEN,iCAAQ;AACJ,oCADI,EACA,YADA,EACM;AADN;AAFF,qBAAJ,CAXd;;AAAA;AAiBQ,iCAAa,OAAb,CAAqB,MAArB,EAA4B,yBAAe;AACvC,gCADuC,EACnC,YADmC,EAC7B,UAAS,IADoB,EACf;AADe,qBAAf,CAA5B;AAGA,sCAAQ,OAAR,CAAgB,OAAhB;AApBR;AAAA;;AAAA;AAAA;AAAA;;AAsBQ,sCAAQ,KAAR;AAtBR;AAAA,2BAuBc,kBAAI;AACN,8BAAK;AADC,qBAAJ,CAvBd;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AA6BA,SAAU,UAAV;AAAA;AAAA;AAAA;AAAA;AAAA,mDACW,2BAAW,OAAX,EAAmB,YAAnB,CADX;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAIA,SAAU,WAAV;AAAA;AAAA;AAAA;AAAA;AAAA,mDACW,2BAAW,QAAX,EAAoB,YAAU;AACjC,qCAAa,KAAb;AACA,0CAAQ,OAAR,CAAgB,MAAhB;AACA,+BAAO,QAAP,CAAgB,MAAhB;AACH,qBAJM,CADX;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAQA,SAAU,qBAAV,CAAgC,MAAhC;AAAA,0BAGY,GAHZ,EAIY,OAJZ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uCAKY,OAAO,OALnB;AAGY,uBAHZ,oBAGY,GAHZ;AAIY,2BAJZ,oBAIY,OAJZ;AAAA;AAAA,2BAMc,yCAAoB,OAApB,EAA4B,GAA5B,CANd;;AAAA;AAAA;AAAA,2BAOc,kBAAI;AACN,8BAAK;AADC,qBAAJ,CAPd;;AAAA;AAUQ,sCAAQ,OAAR,CAAgB,OAAhB;AAVR;AAAA;;AAAA;AAAA;AAAA;;AAYQ,sCAAQ,KAAR;AAZR;AAAA,2BAac,kBAAI;AACN,8BAAK;AADC,qBAAJ,CAbd;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAmBA,SAAU,mBAAV;AAAA;AAAA;AAAA;AAAA;AAAA,mDACW,2BAAW,gBAAX,EAA4B,qBAA5B,CADX;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAIe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2BACL,CACF,mBAAK,UAAL,CADE,EAEF,mBAAK,WAAL,CAFE,EAGF,mBAAK,mBAAL,CAHE,CADK;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA","file":"auth.js","sourceRoot":"D:/github/admin-antd","sourcesContent":["import {\r\n    takeLatest\r\n} from 'redux-saga'\r\nimport {\r\n    fork,put,call\r\n} from 'redux-saga/effects'\r\nimport {\r\n    login,\r\n    changePassword\r\n} from '../services/auth'\r\nimport {\r\n    message\r\n} from 'antd'\r\n\r\nfunction* loginHandler(action){\r\n    try {\r\n        const {\r\n            account,\r\n            pwd\r\n        } = action.payload\r\n        const res = yield call(login,account,pwd)\r\n        const {\r\n            key,token\r\n        } = res\r\n        const lastLoginTime = Date.now()\r\n        yield put({\r\n            type:'login/success',\r\n            payload:{\r\n                key,token,lastLoginTime\r\n            }\r\n        })\r\n        localStorage.setItem('auth',JSON.stringify({\r\n            key,token,isAuthed:true,lastLoginTime\r\n        }))\r\n        message.success('登录成功!')\r\n    } catch (error) {\r\n        message.error(error)\r\n        yield put({\r\n            type:'login/failure'\r\n        })\r\n    }\r\n}\r\n\r\nfunction* watchLogin(){\r\n    yield* takeLatest('login',loginHandler)\r\n}\r\n\r\nfunction* watchLogout() {\r\n    yield* takeLatest('logout',function(){\r\n        localStorage.clear()\r\n        message.success('成功登出')\r\n        window.location.reload()\r\n    })\r\n}\r\n\r\nfunction* changePasswordHandler(action){\r\n    try {\r\n        const {\r\n            pwd,\r\n            old_pwd\r\n        } = action.payload\r\n        yield call(changePassword,old_pwd,pwd)\r\n        yield put({\r\n            type:'changePassword/success'\r\n        })\r\n        message.success('修改成功!')\r\n    } catch (error) {\r\n        message.error(error)\r\n        yield put({\r\n            type:'changePassword/failure'\r\n        })\r\n    }\r\n}\r\n\r\nfunction* watchChangePassword() {\r\n    yield* takeLatest('changePassword',changePasswordHandler)\r\n}\r\n\r\nexport default function* () {\r\n    yield [\r\n        fork(watchLogin),\r\n        fork(watchLogout),\r\n        fork(watchChangePassword)\r\n    ]\r\n}"]}